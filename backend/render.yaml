services:
  - type: web
    name: ecommerce
    env: python
    plan: free

    buildCommand: |
      pip install --upgrade pip
      chmod +x build.sh
      ./build.sh

    startCommand: gunicorn backend.backend.wsgi:application --timeout 120

    postDeployCommand: |
      export DJANGO_SETTINGS_MODULE=backend.backend.settings
      python backend/manage.py migrate

    envVars:
      - fromDotEnv: true

databases:
  - name: ecommerce_db
    plan: free

envVars:
  - fromDotEnv: true
  - key: DATABASE_URL
    fromDatabase:
      name: ecommerce_db
      property: connectionString
